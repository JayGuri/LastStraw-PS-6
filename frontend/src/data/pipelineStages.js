export const PIPELINE_STAGES = [
  {
    id: 'ingest',
    num: '01',
    name: 'Scene Ingestion',
    icon: 'üõ∞Ô∏è',
    description: 'Query GEE / Planetary Computer STAC catalog, filter Sentinel-1 GRD scenes by AOI + date + max cloud cover 20%, fetch raw GeoTIFF tiles, store metadata in scenes table.',
    inputs:  ['AOI GeoJSON', 'Date range', 'Sensor: S1_GRD'],
    outputs: ['raw.tif ‚Üí s3://scenes/{aoi}/{scene}/raw.tif', 'Scene metadata record'],
    libs:    ['earthengine-api', 'pystac-client', 'boto3', 'planetary-computer'],
    duration: 340,
    logs: [
      { level: 'INFO', msg: 'Querying Planetary Computer STAC catalog for aoi=BD-DELTA-01' },
      { level: 'INFO', msg: 'Date range: 2024-10-20 ‚Üí 2024-11-04. Max cloud: 20%' },
      { level: 'DATA', msg: '7 Sentinel-1 GRD scenes matched. Orbit: DESCENDING, Polarization: VV+VH' },
      { level: 'INFO', msg: 'Fetching pre-event composite (2024-10-01 ‚Üí 2024-10-15)' },
      { level: 'INFO', msg: 'Fetching post-event composite (2024-10-25 ‚Üí 2024-11-04)' },
      { level: 'OK',   msg: 'Ingestion complete. 2 √ó 144,000 km¬≤ GeoTIFFs written to S3' },
    ],
  },
  {
    id: 'preprocess',
    num: '02',
    name: 'SAR Preprocessing',
    icon: '‚öôÔ∏è',
    description: 'Apply orbit correction, thermal noise removal, radiometric calibration to sigma-naught, range-Doppler terrain correction using SRTM DEM, speckle filtering (Lee 7√ó7), reproject and tile into 512√ó512 chips.',
    inputs:  ['raw.tif (VV + VH)', 'SRTM DEM (ancillary)'],
    outputs: ['analysis_ready.tif (sigma0, float32)', '512√ó512 tiles for DL inference'],
    libs:    ['SNAP', 'GDAL 3.8', 'rasterio', 'numpy'],
    duration: 620,
    logs: [
      { level: 'INFO', msg: 'Loading pre_event.tif ‚Äî 144 000 km¬≤ scene, UTM zone 45N' },
      { level: 'INFO', msg: 'Applying orbit file correction' },
      { level: 'INFO', msg: 'Thermal noise removal on VV, VH channels' },
      { level: 'INFO', msg: 'Radiometric calibration ‚Üí sigma-naught (linear)' },
      { level: 'INFO', msg: 'Range-Doppler terrain correction with SRTM 30m' },
      { level: 'INFO', msg: 'Lee speckle filter 7√ó7 kernel applied' },
      { level: 'DATA', msg: 'Tiling: 562 √ó 512√ó512 chips generated (64px overlap)' },
      { level: 'OK',   msg: 'SAR preprocessing complete. Output: sigma0_vv.tif, sigma0_vh.tif' },
    ],
  },
  {
    id: 'detect',
    num: '03',
    name: 'Flood Detection',
    icon: 'üîç',
    description: 'Run Otsu thresholding on SAR backscatter difference image at ‚àí16 dB water threshold. Optional: U-Net ONNX model (Sen1Floods11) for deep learning segmentation. Subtract JRC permanent water to isolate new flood.',
    inputs:  ['sigma0_vv.tif (post)', 'sigma0_vv.tif (pre)', 'JRC permanent water mask'],
    outputs: ['flood_mask.tif (uint8)', 'flood_polygons.geojson', 'confidence_map.tif'],
    libs:    ['scikit-image', 'opencv-headless', 'onnxruntime', 'rasterio.features'],
    duration: 480,
    logs: [
      { level: 'INFO', msg: 'Computing log-ratio difference: post ‚àí pre (sigma0 dB)' },
      { level: 'DATA', msg: 'Otsu threshold auto-computed: ‚àí16.3 dB (target: ‚àí16.0 dB)' },
      { level: 'INFO', msg: 'Applying morphological opening (kernel 3√ó3) ‚Äî noise removal' },
      { level: 'INFO', msg: 'Subtracting JRC permanent water layer (occurrence ‚â• 90%)' },
      { level: 'DATA', msg: 'U-Net ONNX inference: 562 tiles processed, avg confidence 0.874' },
      { level: 'INFO', msg: 'Vectorising raster ‚Üí GeoJSON polygons via rasterio.features.shapes' },
      { level: 'OK',   msg: 'Flood mask complete: 18 400 km¬≤ new inundation detected' },
    ],
  },
  {
    id: 'risk',
    num: '04',
    name: 'Risk Scoring',
    icon: 'üìä',
    description: 'Spatial join of flood polygons against GADM Level-2 district boundaries. Compute per-district flooded_area_km¬≤, pct_area_flooded, population_exposed (WorldPop intersection), and composite risk score via Hazard √ó Exposure formula.',
    inputs:  ['flood_polygons.geojson', 'GADM L2 boundaries', 'WorldPop 100m grid'],
    outputs: ['district_stats table rows (per district)', 'risk_level ‚àà {Low,Medium,High,Critical}'],
    libs:    ['geopandas', 'PostGIS', 'shapely 2.x', 'pyproj'],
    duration: 290,
    logs: [
      { level: 'INFO', msg: 'Spatial join: flood polygons ‚à© 64 GADM L2 district boundaries' },
      { level: 'INFO', msg: 'CRS alignment: EPSG:32645 (UTM) ‚Üí EPSG:4326 (geographic)' },
      { level: 'DATA', msg: 'Top flood district: Sylhet ‚Äî 67.2% flooded, 842 000 exposed' },
      { level: 'DATA', msg: 'WorldPop zonal stats complete. 4.2M population in flood zone' },
      { level: 'INFO', msg: 'Risk scoring: f(flood_pct, pop_exposed, elev_risk)' },
      { level: 'DATA', msg: 'Risk levels: 3 Critical, 5 High, 7 Medium, 5 Low, 44 None' },
      { level: 'OK',   msg: 'district_stats table: 64 rows inserted' },
    ],
  },
  {
    id: 'persist',
    num: '05',
    name: 'Persist & Serve',
    icon: 'üóÑÔ∏è',
    description: 'Write flood_results, district_stats, and run_logs to PostgreSQL/PostGIS. Update run status to completed. Invalidate Redis response cache. Presigned S3 URLs generated for GeoTIFF download (15-min TTL).',
    inputs:  ['flood_results payload', 'district_stats array', 'run_logs entries'],
    outputs: ['run.status = completed', 'API endpoints live', 'S3 presigned URL'],
    libs:    ['asyncpg', 'SQLAlchemy 2.x', 'GeoAlchemy2', 'redis', 'boto3'],
    duration: 180,
    logs: [
      { level: 'INFO', msg: 'Starting transaction: inserting flood_results for run RUN-20241105-BD-001' },
      { level: 'INFO', msg: 'Bulk insert: 64 district_stats rows via COPY protocol' },
      { level: 'INFO', msg: 'Uploading flood_mask.tif to S3 as Cloud-Optimized GeoTIFF' },
      { level: 'INFO', msg: 'Generating presigned URL (TTL: 900s)' },
      { level: 'INFO', msg: 'Redis cache invalidated for aoi=BD-DELTA-01' },
      { level: 'DATA', msg: 'run_logs persisted: 38 entries across 5 stages' },
      { level: 'OK',   msg: 'Run RUN-20241105-BD-001 status ‚Üí COMPLETED (38m 12s total)' },
    ],
  },
]
